<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QuickConvert - Image and Text Format Converter</title>
  <meta name="description" content="QuickConvert: Fast image and text format converter including JPG, PNG, WebP, JSON, CSV, TXT, Markdown, and more!">
  <meta name="keywords" content="Image Converter, Text Converter, JPG to PNG, JSON to CSV, Quick Convert, Online Tool">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gif.js.optimized/dist/gif.min.js"></script>
  <style>
    body {
      background: linear-gradient(to right, #83a4d4, #b6fbff);
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .container {
      background: white;
      border-radius: 20px;
      padding: 30px;
      max-width: 1200px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    }
    h1 {
      color: #0056b3;
      font-family: 'Poppins', sans-serif;
    }
    h2 {
      color: #004080;
      font-weight: bold;
      font-size: 28px;
      margin-top: 20px;
      margin-bottom: 20px;
    }
    label {
      font-weight: bold;
      color: #007bff;
      font-size: 18px;
      margin-bottom: 5px;
    }
    .btn-custom {
      background: linear-gradient(to right, #4facfe, #00f2fe);
      border: none;
      color: white;
      font-weight: bold;
      padding: 10px 20px;
      margin: 10px;
    }
    .tab-content {
      margin-top: 20px;
    }
    .hidden {
      display: none;
    }
    textarea {
      width: 100%;
      height: 200px;
      margin-bottom: 10px;
      border-radius: 10px;
      padding: 10px;
    }
    pre {
      background: #f2f2f2;
      padding: 15px;
      border-radius: 10px;
      max-height: 300px;
      overflow: auto;
    }
    .section {
      background: #f9f9f9;
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 20px;
    }
    .preview img {
      max-width: 100%;
      margin: 5px;
      border-radius: 10px;
    }
    .preview .img-container {
      text-align: center;
      margin: 10px;
    }
  </style>
</head>

<body>

<div class="container">
  <h1 class="text-center mb-4">QuickConvert</h1>

  <div class="text-center">
    <button class="btn btn-custom" onclick="showTab('image')">Image Conversion</button>
    <button class="btn btn-custom" onclick="showTab('text')">Text Conversion</button>
  </div>

  <!-- Image Conversion Tab -->
  <div id="imageTab" class="tab-content">
    <div class="row g-4">

      <!-- Convert Single Image -->
      <div class="col-md-6">
        <div class="section">
          <h2 class="text-center mb-3">Convert Single Image</h2>
          <input type="file" id="singleFileInput" class="form-control mb-3" accept="image/png, image/jpeg, image/webp" />
          <select id="singleFormatSelect" class="form-select mb-3">
            <option value="image/jpeg">Convert to JPG</option>
            <option value="image/png">Convert to PNG</option>
            <option value="image/webp">Convert to WEBP</option>
          </select>
          <div class="mb-3">
            <label>Resize (optional):</label>
            <div class="d-flex gap-2">
              <input type="number" id="resizeWidth" class="form-control" placeholder="Width (px)" />
              <input type="number" id="resizeHeight" class="form-control" placeholder="Height (px)" />
            </div>
          </div>
          <button onclick="previewSingleImage()" class="btn btn-custom mb-3">Preview</button>
          <div id="singlePreview" class="preview"></div>
          <div id="singleDownload" class="text-center mt-3"></div>
        </div>
      </div>

      <!-- Convert Multiple Images -->
      <div class="col-md-6">
        <div class="section">
          <h2 class="text-center mb-3">Convert Multiple Images</h2>
          <input type="file" id="batchFileInput" class="form-control mb-3" multiple accept="image/png, image/jpeg, image/webp" />
          <select id="batchFormatSelect" class="form-select mb-3">
            <option value="image/jpeg">Convert to JPG</option>
            <option value="image/png">Convert to PNG</option>
            <option value="image/webp">Convert to WEBP</option>
          </select>
          <div class="mb-3">
            <label>Batch Resize (optional):</label>
            <div class="d-flex gap-2">
              <input type="number" id="batchResizeWidth" class="form-control" placeholder="Width (px)" />
              <input type="number" id="batchResizeHeight" class="form-control" placeholder="Height (px)" />
            </div>
          </div>
          <button onclick="convertBatchImages()" class="btn btn-custom mb-3">Batch Convert</button>
          <div id="batchPreview" class="preview d-flex flex-wrap justify-content-center"></div>
        </div>
      </div>

      <!-- Compress Image -->
      <div class="col-md-6">
        <div class="section">
          <h2 class="text-center mb-3">Compress Image</h2>
          <input type="file" id="compressFileInput" class="form-control mb-3" accept="image/png, image/jpeg, image/webp" />
          <select id="compressQuality" class="form-select mb-3">
            <option value="0.9">90% Quality</option>
            <option value="0.7">70% Quality</option>
            <option value="0.5">50% Quality</option>
            <option value="0.3">30% Quality</option>
          </select>
          <button onclick="compressImage()" class="btn btn-custom mb-3">Compress</button>
          <div id="compressPreview" class="preview"></div>
          <div id="compressDownload" class="text-center mt-3"></div>
        </div>
      </div>

      <!-- PDF to JPG -->
      <div class="col-md-6">
        <div class="section">
          <h2 class="text-center mb-3">PDF to JPG</h2>
          <input type="file" id="pdfFileInput" class="form-control mb-3" accept="application/pdf" />
          <button onclick="convertPdfToJpg()" class="btn btn-custom mb-3">Convert PDF</button>
          <div id="pdfPreview" class="preview"></div>
          <div id="pdfDownload" class="text-center mt-3"></div>
        </div>
      </div>

    </div>
  </div>
  <!-- Text Conversion Tab -->
  <div id="textTab" class="tab-content hidden">
    <div class="section">
      <h2 class="text-center mb-3">JSON ⇄ CSV ⇄ TXT Conversion</h2>
      <!-- For JSON/CSV/TXT -->
<div class="mb-2">
  <input type="file" id="textFileInput" accept=".json,.csv,.txt" onchange="handleFileUpload('textFileInput','textInput')" />
</div>
      <textarea id="textInput" placeholder="Paste your text here..."></textarea>
      <div class="d-flex flex-wrap gap-2 justify-content-center">
        <button onclick="convertJsonToCsv()" class="btn btn-custom">JSON to CSV</button>
        <button onclick="convertCsvToJson()" class="btn btn-custom">CSV to JSON</button>
        <button onclick="convertJsonToTxt()" class="btn btn-custom">JSON to TXT</button>
        <button onclick="convertTxtToJson()" class="btn btn-custom">TXT to JSON</button>
      </div>
      <div id="textOutput" class="mt-3"></div>
    </div>

    <div class="section">
      <h2 class="text-center mb-3">Markdown ⇄ HTML Conversion</h2>
      <!-- For Markdown -->
<div class="mb-2">
  <input type="file" id="markdownFileInput" accept=".md,.txt" onchange="handleFileUpload('markdownFileInput','markdownInput')" />
</div>
      <textarea id="markdownInput" placeholder="Paste your Markdown here..."></textarea>
      <div class="d-flex flex-wrap gap-2 justify-content-center">
        <button onclick="convertMarkdownToHtml()" class="btn btn-custom">Markdown to HTML</button>
      </div>
      <div id="markdownOutput" class="p-3 bg-light rounded mt-3" style="min-height:200px;"></div>

    </div>
  </div>

</div> <!-- End of container -->

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<script>
// --- Tab Switching ---
function showTab(tab) {
  document.getElementById('imageTab').classList.add('hidden');
  document.getElementById('textTab').classList.add('hidden');
  if (tab === 'image') {
    document.getElementById('imageTab').classList.remove('hidden');
  } else {
    document.getElementById('textTab').classList.remove('hidden');
  }
}

// --- Text Conversions ---
// --- Tab Switching ---
function showTab(tab) {
  document.getElementById('imageTab').classList.add('hidden');
  document.getElementById('textTab').classList.add('hidden');
  if (tab === 'image') {
    document.getElementById('imageTab').classList.remove('hidden');
  } else {
    document.getElementById('textTab').classList.remove('hidden');
  }
}

// --- Upload File for Text Conversion ---
function handleFileUpload(inputId, textareaId) {
  const file = document.getElementById(inputId).files[0];
  const reader = new FileReader();
  reader.onload = function(e) {
    document.getElementById(textareaId).value = e.target.result;
  };
  reader.readAsText(file);
}

// --- Text Conversions ---

// JSON -> CSV
function convertJsonToCsv() {
  try {
    const input = JSON.parse(document.getElementById('textInput').value);
    if (!Array.isArray(input)) {
      alert("Input must be a JSON array (e.g., [{}, {}]) to convert to CSV.");
      return;
    }
    const csvRows = [];
    const headers = Object.keys(input[0]);
    csvRows.push(headers.join(","));
    input.forEach(obj => {
      const values = headers.map(header => JSON.stringify(obj[header] ?? ""));
      csvRows.push(values.join(","));
    });
    document.getElementById('textOutput').innerHTML = `<pre>${csvRows.join("\n")}</pre>`;
  } catch (e) {
    alert("Invalid JSON format.");
  }
}

// CSV -> JSON
function convertCsvToJson() {
  try {
    const csv = document.getElementById('textInput').value.trim();
    const lines = csv.split("\n");
    const headers = lines[0].split(",");
    const json = lines.slice(1).map(line => {
      const values = line.split(",");
      return headers.reduce((obj, header, i) => {
        obj[header] = values[i];
        return obj;
      }, {});
    });
    document.getElementById('textOutput').innerHTML = `<pre>${JSON.stringify(json, null, 2)}</pre>`;
  } catch (e) {
    alert("Invalid CSV format.");
  }
}

// JSON -> TXT
function convertJsonToTxt() {
  try {
    const json = JSON.parse(document.getElementById('textInput').value);
    const txt = JSON.stringify(json, null, 2);
    document.getElementById('textOutput').innerHTML = `<pre>${txt}</pre>`;
  } catch (e) {
    alert("Invalid JSON format.");
  }
}

// TXT -> JSON
function convertTxtToJson() {
  try {
    const txt = document.getElementById('textInput').value;
    const json = JSON.parse(txt);
    document.getElementById('textOutput').innerHTML = `<pre>${JSON.stringify(json, null, 2)}</pre>`;
  } catch (e) {
    alert("Invalid TXT/JSON format.");
  }
}

// Markdown -> HTML
function convertMarkdownToHtml() {
  const markdown = document.getElementById('markdownInput').value;
  const html = marked(markdown);
  document.getElementById('markdownOutput').innerHTML = html;
}

// --- Image Conversions (Compress, Crop, Remove BG, PDF to JPG) ---
function previewSingleImage() {
  const file = document.getElementById("singleFileInput").files[0];
  const format = document.getElementById("singleFormatSelect").value;
  const width = parseInt(document.getElementById("resizeWidth").value);
  const height = parseInt(document.getElementById("resizeHeight").value);
  const preview = document.getElementById("singlePreview");
  const downloadArea = document.getElementById("singleDownload");
  preview.innerHTML = "";
  downloadArea.innerHTML = "";

  if (!file) {
    alert("Please upload an image.");
    return;
  }

  const reader = new FileReader();
  reader.onload = function(e) {
    const img = new Image();
    img.onload = function() {
      const canvas = document.createElement("canvas");
      canvas.width = width || img.width;
      canvas.height = height || img.height;
      canvas.getContext("2d").drawImage(img, 0, 0, canvas.width, canvas.height);

      canvas.toBlob(function(blob) {
        const url = URL.createObjectURL(blob);
        const newImg = new Image();
        newImg.src = url;
        newImg.style.maxWidth = "100%";
        newImg.style.borderRadius = "10px";
        preview.appendChild(newImg);

        const link = document.createElement("a");
        link.href = url;
        link.download = "converted." + format.split("/")[1];
        link.className = "btn btn-custom mt-3";
        link.textContent = "Download Converted Image";
        downloadArea.appendChild(link);
      }, format);
    };
    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
}

function convertBatchImages() {
  const files = document.getElementById("batchFileInput").files;
  const format = document.getElementById("batchFormatSelect").value;
  const width = parseInt(document.getElementById("batchResizeWidth").value);
  const height = parseInt(document.getElementById("batchResizeHeight").value);
  const preview = document.getElementById("batchPreview");
  preview.innerHTML = "";

  if (!files.length) {
    alert("Please upload images.");
    return;
  }

  Array.from(files).forEach(file => {
    const reader = new FileReader();
    reader.onload = function(e) {
      const img = new Image();
      img.onload = function() {
        const canvas = document.createElement("canvas");
        canvas.width = width || img.width;
        canvas.height = height || img.height;
        canvas.getContext("2d").drawImage(img, 0, 0, canvas.width, canvas.height);

        canvas.toBlob(function(blob) {
          const url = URL.createObjectURL(blob);
          const container = document.createElement("div");
          container.className = "img-container";

          const newImg = new Image();
          newImg.src = url;
          newImg.style.maxWidth = "100%";
          newImg.style.borderRadius = "10px";
          container.appendChild(newImg);

          const link = document.createElement("a");
          link.href = url;
          link.download = "converted." + format.split("/")[1];
          link.className = "btn btn-custom mt-2 d-block mx-auto";
          link.textContent = "Download";
          container.appendChild(link);

          preview.appendChild(container);
        }, format);
      };
      img.src = e.target.result;
    };
    reader.readAsDataURL(file);
  });
}

// Compress, Crop, Remove BG, and PDF to JPG
// （这几部分在前面我们已经发过代码，这里继续沿用！）
// --- Compress Image ---
function compressImage() {
  const file = document.getElementById("compressFileInput").files[0];
  const quality = parseFloat(document.getElementById("compressQuality").value);
  const preview = document.getElementById("compressPreview");
  const downloadArea = document.getElementById("compressDownload");
  preview.innerHTML = "";
  downloadArea.innerHTML = "";

  if (!file) {
    alert("Please upload an image.");
    return;
  }

  const reader = new FileReader();
  reader.onload = function(e) {
    const img = new Image();
    img.onload = function() {
      const canvas = document.createElement("canvas");
      canvas.width = img.width;
      canvas.height = img.height;
      canvas.getContext("2d").drawImage(img, 0, 0);

      canvas.toBlob(function(blob) {
        const url = URL.createObjectURL(blob);
        const compressedImg = new Image();
        compressedImg.src = url;
        compressedImg.style.maxWidth = "100%";
        compressedImg.style.borderRadius = "10px";
        preview.appendChild(compressedImg);

        const link = document.createElement("a");
        link.href = url;
        link.download = "compressed.jpg";
        link.className = "btn btn-custom mt-3";
        link.textContent = "Download Compressed Image";
        downloadArea.appendChild(link);
      }, 'image/jpeg', quality);
    };
    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
}

// --- Crop Image with Cropper.js ---
// --- Crop Image (优化版上传即裁剪) ---
let cropper;

document.getElementById("cropFileInput").addEventListener("change", function(event) {
  const file = event.target.files[0];
  const preview = document.getElementById("cropPreview");
  const downloadArea = document.getElementById("cropDownload");
  preview.innerHTML = "";
  downloadArea.innerHTML = "";

  if (!file) {
    alert("Please upload an image.");
    return;
  }

  const reader = new FileReader();
  reader.onload = function(e) {
    const img = new Image();
    img.id = "cropImage";
    img.src = e.target.result;
    img.style.maxWidth = "100%";
    img.style.borderRadius = "10px";
    preview.appendChild(img);

    if (cropper) {
      cropper.destroy();
    }
    cropper = new Cropper(img, {
      aspectRatio: NaN,
      viewMode: 1,
    });
  };
  reader.readAsDataURL(file);
});

function cropImage() {
  const downloadArea = document.getElementById("cropDownload");
  downloadArea.innerHTML = "";

  if (!cropper) {
    alert("Please upload and crop an image first!");
    return;
  }

  const canvas = cropper.getCroppedCanvas();
  canvas.toBlob(function(blob) {
    const url = URL.createObjectURL(blob);
    const link = document.createElement("a");
    link.href = url;
    link.download = "cropped.jpg";
    link.className = "btn btn-custom mt-3";
    link.textContent = "Download Cropped Image";
    downloadArea.appendChild(link);
  }, 'image/jpeg');
}


// --- Create GIF (优化版自动resize+loading提示) ---
function createGif() {
  const files = document.getElementById("gifFileInput").files;
  const delay = parseInt(document.getElementById("gifDelay").value);
  const preview = document.getElementById("gifPreview");
  const downloadArea = document.getElementById("gifDownload");
  preview.innerHTML = "Creating GIF, please wait...";
  downloadArea.innerHTML = "";

  if (!files.length) {
    alert("Please upload multiple images to create a GIF.");
    return;
  }

  const gif = new GIF({
    workers: 2,
    quality: 10,
    workerScript: 'https://cdn.jsdelivr.net/npm/gif.js.optimized/dist/gif.worker.js'
  });

  let loadedImages = 0;
  Array.from(files).forEach(file => {
    const reader = new FileReader();
    reader.onload = function(e) {
      const img = new Image();
      img.onload = function() {
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");

        // resize to max 800px width (preserve aspect ratio)
        let maxWidth = 800;
        let ratio = img.width / img.height;
        if (img.width > maxWidth) {
          canvas.width = maxWidth;
          canvas.height = maxWidth / ratio;
        } else {
          canvas.width = img.width;
          canvas.height = img.height;
        }

        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

        gif.addFrame(canvas, { delay: delay });
        loadedImages++;
        if (loadedImages === files.length) {
          gif.render();
        }
      };
      img.src = e.target.result;
    };
    reader.readAsDataURL(file);
  });

  gif.on('finished', function(blob) {
    const url = URL.createObjectURL(blob);
    preview.innerHTML = "";
    const gifImg = new Image();
    gifImg.src = url;
    gifImg.style.maxWidth = "100%";
    gifImg.style.borderRadius = "10px";
    preview.appendChild(gifImg);

    const link = document.createElement("a");
    link.href = url;
    link.download = "created.gif";
    link.className = "btn btn-custom mt-3";
    link.textContent = "Download GIF";
    downloadArea.appendChild(link);
  });
}


// --- PDF to JPG ---
function convertPdfToJpg() {
  const file = document.getElementById("pdfFileInput").files[0];
  const preview = document.getElementById("pdfPreview");
  const downloadArea = document.getElementById("pdfDownload");
  preview.innerHTML = "";
  downloadArea.innerHTML = "";

  if (!file) {
    alert("Please upload a PDF.");
    return;
  }

  const reader = new FileReader();
  reader.onload = function(e) {
    const pdfData = new Uint8Array(e.target.result);
    pdfjsLib.getDocument({ data: pdfData }).promise.then(function(pdf) {
      pdf.getPage(1).then(function(page) {
        const viewport = page.getViewport({ scale: 2.0 });
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        canvas.height = viewport.height;
        canvas.width = viewport.width;

        const renderContext = {
          canvasContext: ctx,
          viewport: viewport
        };
        page.render(renderContext).promise.then(function() {
          canvas.toBlob(function(blob) {
            const url = URL.createObjectURL(blob);
            const pdfImg = new Image();
            pdfImg.src = url;
            pdfImg.style.maxWidth = "100%";
            pdfImg.style.borderRadius = "10px";
            preview.appendChild(pdfImg);

            const link = document.createElement("a");
            link.href = url;
            link.download = "pdf-page.jpg";
            link.className = "btn btn-custom mt-3";
            link.textContent = "Download JPG";
            downloadArea.appendChild(link);
          }, 'image/jpeg');
        });
      });
    });
  };
  reader.readAsArrayBuffer(file);
}

</script>

</body>
</html>
